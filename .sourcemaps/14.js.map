{"version":3,"sources":["../../src/pages/cards/cards.module.ts","../../src/pages/cards/cards.ts"],"names":[],"mappings":"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","file":"14.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { IonicPageModule } from 'ionic-angular';\n\nimport { CardsPage } from './cards';\n\n@NgModule({\n  declarations: [\n    CardsPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CardsPage),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    CardsPage\n  ]\n})\nexport class CardsPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cards/cards.module.ts","import { Component } from '@angular/core';\nimport { ViewChild } from '@angular/core';\nimport { Searchbar } from 'ionic-angular';\nimport { IonicPage, NavController } from 'ionic-angular';\nimport { Http } from '@angular/http';\nimport {HttpModule, Headers, RequestOptions, Response} from '@angular/http'\nimport 'rxjs/add/operator/map';\nimport { Observable } from 'rxjs/Observable';\nimport { Storage } from '@ionic/storage';\nimport { Platform } from 'ionic-angular';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { NativeGeocoder, NativeGeocoderReverseResult, NativeGeocoderForwardResult } from '@ionic-native/native-geocoder';\n\nimport firebase from 'firebase';\n\n@IonicPage()\n@Component({\n  selector: 'page-cards',\n  templateUrl: 'cards.html'\n})\nexport class CardsPage {\n  @ViewChild('topSearch') searchbar: Searchbar;\n\n  cardItems: any[];\n\n  eventOpened: Boolean = false;\n\n  isRegister: Boolean = true;\n\n  user = firebase.auth().currentUser;\n\n  ios: Boolean;\n\n  latitude : any;\n  longitude : any;\n  userLat: any;\n  userLong: any;\n  distance: number;\n\n  searched: Boolean = false;\n\n  baseUrl: string = 'https://yourunity.org';\n\n  constructor(public navCtrl: NavController, public http: Http, public storage: Storage, public platform: Platform, private nativeGeocoder: NativeGeocoder, private geolocation: Geolocation) {\n    if (this.platform.is('ios')) {\n      this.ios = true;\n    }\n    else {\n      this.ios = false;\n    }\n  }\n\n  ionViewDidLoad() {\n    this.pullEvents();\n  }\n\n  pullEvents() {\n    this.http.get(this.baseUrl + '/api/events').map(res => res.json()).subscribe(data => {\n      this.cardItems = data;\n      console.log(this.cardItems);\n\n      this.geolocation.getCurrentPosition().then((resp) => {\n        this.userLat = resp.coords.latitude;\n        this.userLong = resp.coords.longitude;\n       }).catch((error) => {\n         console.log('Error getting location', error);\n       });\n\n      for(var i = 0; i < this.cardItems.length; i++) {\n        var item = this.cardItems[i];\n        this.storage.get(item.id.toString()).then((val) => {\n          if(val) {\n            this.setRegister(item, false);\n          }\n          else {\n            this.setRegister(item, true);\n          }      \n        }); \n      }\n\n      this.calculateCoords(this.cardItems);\n    });\n\n    console.log(\"Lat: \" + this.userLat);\n    console.log(\"Long: \" + this.userLong);\n  }\n\n  calculateCoords(cardItems) {\n    for(var i = 0; i < this.cardItems.length; i++) {\n      var item = this.cardItems[i];\n\n      item.distance = this.calculateDistance(this.userLat, item.latitude, this.userLong, item.longitude);\n    }\n  }\n\n  calculateDistance(lat1:number,lat2:number,long1:number,long2:number){\n    let p = 0.017453292519943295;    // Math.PI / 180\n    let c = Math.cos;\n    let a = 0.5 - c((lat1-lat2) * p) / 2 + c(lat2 * p) *c((lat1) * p) * (1 - c(((long1- long2) * p))) / 2;\n    let dis = (12742 * Math.asin(Math.sqrt(a))); // 2 * R; R = 6371 km\n    dis = Math.round( ((dis)) * 10 ) / 10;\n    return dis;\n  }\n\n  register(item) {\n    var user_id = firebase.auth().currentUser.uid;\n    var url = this.baseUrl + '/api/register_event';\n    var data = {\n      \"event_id\" : item.id,\n      \"firedb_id\" : user_id,\n      \"check_in_time\" : 0,\n      \"duration\" : 0,\n      \"activity_status\" : 2\n    };\n\n    let headers = new Headers ({ 'Content-Type': 'application/json' });\n    let options = new RequestOptions({ headers: headers }); \n\n    // Check in user on server\n    this.http.post(url, JSON.stringify(data), options)\n    .map(res => res.json())\n    .subscribe(data =>\n      console.log(data)\n    );\n\n    console.log(\"Registration completed\");\n\n    item.isRegister = false;\n\n    this.storage.set(item.id.toString(), \"registered\");\n  }\n\n  openEvent(item) {\n    this.storage.get(item.id.toString()).then((val) => {\n      if(val) {\n        item.isRegister = false;\n      }\n      else {\n        item.isRegister = true;\n      }      \n    }); \n\n    item.eventOpened = !item.eventOpened;\n    this.eventOpened = !this.eventOpened;\n\n    console.log();\n    console.log(item.latitude);\n    console.log(item.longitude);\n  }\n\n  isOpened() {\n    return this.eventOpened;\n  }\n\n  isCardOpened(item) {\n    return item.eventOpened;\n  }\n\n  canRegister(item) {\n    return item.isRegister;\n  }\n\n  doRefresh(refresher) {\n    this.pullEvents();\n\n    setTimeout(() => {\n      console.log('Async operation has ended');\n      refresher.complete();\n    }, 700);\n  }\n\n  private setRegister(item, isIt) {\n    console.log(\"Function called on ID \" + item.id + \", isRegistered = \" + isIt);\n    item.isRegister = isIt;\n    console.log(item.isRegister);\n  }\n\n  getEvents(event) {\n    var q = event.srcElement.value; // the query\n\n    if(!q) {\n      return;\n    }\n\n    this.cardItems = this.cardItems.filter((v) => {\n      if((v.event_name && q)) {\n        if(v.event_name.toLowerCase().indexOf(q.toLowerCase()) > -1) {\n          this.searched = true;\n          console.log(this.searched);\n          return true;\n        }\n        return false;\n      }\n    });\n\n    \n  }\n\n  resetSearch() {\n    this.searched = false;\n\n    this.searchbar.clearInput(null);\n\n    this.http.get(this.baseUrl + '/api/events').map(res => res.json()).subscribe(data => {\n      this.cardItems = data;\n      \n      for(var i = 0; i < this.cardItems.length; i++) {\n        var item = this.cardItems[i];\n        this.storage.get(item.id.toString()).then((val) => {\n          if(val) {\n            this.setRegister(item, false);\n          }\n          else {\n            this.setRegister(item, true);\n          }      \n        }); \n      }\n\n      this.calculateCoords(this.cardItems);\n    });\n  }\n\n  isSearched() {\n    return this.searched;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cards/cards.ts"],"sourceRoot":""}